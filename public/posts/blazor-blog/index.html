<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogging with Blazor and Cloudflare | Blowfish</title>
  <meta name="description" content="Personal website and blog">
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>
    <nav>
      <ul>
        
      </ul>
    </nav>
  </header>
  
  <main>
    
<article>
  <h1>Blogging with Blazor and Cloudflare</h1>
  <p>Published on December 13, 2023</p>
  
  <p><a
  href="https://dotnet.microsoft.com/en-us/apps/aspnet/web-apps/blazor"
    target="_blank"
  >Blazor</a> is a dotnet/ C# based web app framework. It promises that you&rsquo;ll be able to <strong>&ldquo;build full stack web apps without writing a line of JavaScript.&rdquo;</strong> At time of writing, this post is hosted on a Blazor frontend application. While building the blogging engine, I discovered that Blazor is cool, it runs on <a
  href="https://pages.cloudflare.com"
    target="_blank"
  >Cloudflare Pages</a>, it&rsquo;s a good dev experience, but it&rsquo;s no substitute for JavaScript (yet).</p>

<h2 class="relative group">Getting started 
    <div id="getting-started" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#getting-started" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>I decided to use a Blazor WASM project for this site, because I wanted to run it on Cloudflare pages. Pages are awesome because they run on Cloudflare&rsquo;s edge network, AND they come for free. Unfortunately, while Cloudflare does offer a &ldquo;server-side&rdquo; environment (called Cloudflare Workers), they only support a Javascript runtime. For full-stack Blazor (including server-side rendering) a different hosting service might be required.</p>
<p>I created this app using dotnet 7:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check dotnet version</span>
</span></span><span class="line"><span class="cl">dotnet --version
</span></span><span class="line"><span class="cl">7.0.401
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">dotnet new blazorwasm -o edge
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Out of the box, this creates a Blazor WASM project with some example components.</p>

<h2 class="relative group">Rendering markdown 
    <div id="rendering-markdown" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#rendering-markdown" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Since I was porting several existing posts, I wanted to keep using markdown as a simple storage format for all my writing. Therefore, I needed a markdown to HTML renderer. I&rsquo;d usually use a pre-built library in this situation, and I quickly discovered that there are many more Javascript implementations than dotnet. Furthermore, WASM applicatons <strong>cannot manipulate the DOM</strong> (<a
  href="https://developer.mozilla.org/en-US/docs/WebAssembly/Concepts#"
    target="_blank"
  >source</a>), which makes client side markdown rendering essentially impossible using only C#.</p>
<p>I decided to expose the raw markdown via GET request, and then render to HTML using <a
  href="https://showdownjs.com"
    target="_blank"
  >Showdown JS</a> and Blazor&rsquo;s JS Interop functionality.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// Post.razor.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">setInnerHtmlFromRequest</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">converter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">Converter</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">content</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">converter</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cs" data-lang="cs"><span class="line"><span class="cl"><span class="c1">// Post.razor</span>
</span></span><span class="line"><span class="cl"><span class="c1">// other implementation omitted</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">async</span> <span class="n">Task</span> <span class="n">LoadPost</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">path</span> <span class="p">=</span> <span class="s">$&#34;/posts/{PostId}.md&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// reference a Javascript module from Blazor</span>
</span></span><span class="line"><span class="cl">    <span class="kt">var</span> <span class="n">module</span> <span class="p">=</span> <span class="k">await</span> <span class="n">JS</span><span class="p">.</span><span class="n">InvokeAsync</span><span class="p">&lt;</span><span class="n">IJSObjectReference</span><span class="p">&gt;(</span><span class="s">&#34;import&#34;</span><span class="p">,</span> <span class="s">&#34;./Pages/Post.razor.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// call a function in the module</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">module</span><span class="p">.</span><span class="n">InvokeVoidAsync</span><span class="p">(</span><span class="s">&#34;setInnerHtmlFromRequest&#34;</span><span class="p">,</span> <span class="n">ContentId</span><span class="p">,</span> <span class="n">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>While this works, it has several downsides:</p>
<ul>
<li>Lack of type safety on Blazor/JS interop calls and responses.</li>
<li>I now need to support Javascript in the project</li>
<li>Small performance hit on interop call</li>
<li>Harder to migrate to server-side rendering</li>
</ul>

<h2 class="relative group">Running on Cloudflare Pages 
    <div id="running-on-cloudflare-pages" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100 select-none">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700 !no-underline" href="#running-on-cloudflare-pages" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>Cloudflare have some <a
  href="https://developers.cloudflare.com/pages/framework-guides/deploy-a-blazor-site/"
    target="_blank"
  >good documentation</a> on how to deploy a Blazor site using Pages. It&rsquo;s quite simple, but the downsides are:</p>
<ul>
<li>cloudflare build agent doesn&rsquo;t have dotnet installed, which increases the build time. My simple project takes ~10 minutes to build on Cloudflare.</li>
<li>Cloudflare doesn&rsquo;t support server-side C# and so there&rsquo;s no server side rendering</li>
<li>No server-side rendering also means no fallback for browsers that don&rsquo;t support WASM.</li>
</ul>
<p>What I get for free with Cloudflare is:</p>
<ul>
<li>Free web hosting</li>
<li>Edge deployments close to the consumer</li>
<li><a
  href="https://developers.cloudflare.com/pages/platform/preview-deployments/"
    target="_blank"
  >Preview deployments</a></li>
</ul>
<p>So as with all engineering challenges, building a blog site with Blazor WASM and Cloudflare has pro&rsquo;s and con&rsquo;s. It&rsquo;s probably better to just statically render your blogs at build time, but where&rsquo;s the fun in that?</p>
<p><a
  href="https://github.com/xtellurian/xtellurian.github.io/"
    target="_blank"
  >Check out the code here</a></p>

  
  
  <div class="tags">
    <p>Tags: 
    
    <span class="tag">blazor</span>
    
    <span class="tag">cloudflare</span>
    
    <span class="tag">web-development</span>
    
    <span class="tag">dotnet</span>
    
    </p>
  </div>
  
</article>

<nav class="post-nav">
  
  
  <a href="/posts/cherry_reflections/" class="prev">Reflections on a startup →</a>
  
</nav>

  </main>
  
  <footer>
    <p>&copy; 2025 Rian Finnegan. All rights reserved.</p>
  </footer>
</body>
</html>
